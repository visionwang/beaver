在上大学学金融的第一堂课上，老师说“金融是什么？金融就是放在冰箱里的一块肉，从冰箱拿出来，再放回去，你没做什么，但是手上已经沾满了油。”后来阅历再多一点，知道支付又是金融的基础，所有这挂的第一层油就从支付开始了。

在支付里面，处于核心功能的之一就是支付路由了。支付路由作为支付的中枢神经功能承担了整个支付收益管理的职能。

如图，在路由的设计里面，由引导路由和交易路由构成。
![](http://i.imgur.com/G7juSLu.png)

简单说引导路由决定了客人能够看到什么，用什么支付方式，是招行借记卡还是农行信用卡，和来老王的超市看到统一方便面还是看到哇哈哈AD钙奶一样；

而交易路由决定了根据策略会走到哪个通道，成本多少，是根据成本优先还是风控优先或者指定优先的逻辑，就跟老王的统一方便面是问老李家进货还是老刘家进货一样。

在引导路由里面，建立各行业不同引导模板及方案，展示控制场景支持支付方式展现和顺序，通过这个控制推荐支付从而达到影响用户支付行为的目的，并且引导模板支持特殊商家不同展现模板制定。

举例：比如境外商户配置的银行要有Visa、Master；而境内的可能就可以忽略；主要业务信用卡还款的商户只能配置借记卡、而酒店、超市买卖的就可以信用卡、借记卡都能用。就和老王遇到不同地段，不同客户的需求不一样的问题一样。

在交易路由里面，通过交易路由规则能够做到把适合的交易推荐到合适的地方，达到降低成本的目的；本身路由规则能够控制通道维护时间处理和通过路由的运维策略实现自动熔断，也就是故障自动切换通道，保证成功率，在支付行业中“支付成功率是第一优先级”。

策略背后对应的是通道，通道都是对应银行或者三方，平时都要处理关系，所以很多时候需要切量且自然。 通过分流的路由规则，可以设定权重、限额，实现通道流量强制分配。以及通过流量分配算法形成或正态分布或强制策略达到各通道交易量控制，这个也就是故事里面老王要处理各个供应商的关系。

举例：

1、工商银行信用卡有2个通道，通道A的收费规则是单笔金额的2‰作为手续费，通道B的收费规则是1元1笔。那么，在其他条件相同的情况下，交易路由根据正常路由规则，会走到成本更低的通道上去，根据金额计算比如500块以下的订单金额就应该走到通道A,而500以上就是通道B

**目的：实现成本最低**

2、工商银行信用卡有2个通道，通道A的收费规则是单笔金额的2‰作为手续费，通道B的收费规则是单笔费率的3‰。那么通道B基本只能用来做备份，在通道A维护的情况下使用，但是作为合作备胎也是有尊严的，你也是要时不时撩一下，给下希望，所以设定每天指定走B十万交易量，走完就全部走A.

**目的：实现通道备份，为自动熔断可用性提供支持**

3、工商银行信用卡有2个通道，通道A的收费规则是单笔金额的2‰作为手续费，通道B的收费规则是单笔费率的3‰。通道A需要支付要素【卡号、姓名、有效期】，通道B需要支付要素【卡号、姓名、证件类型、证件号、银行预留手机号、短信验证码、有效期、CVV】,**此次交易命中风控规则，有交易风险**，所以会下发通道B,即使费率更高也会走通道B，保证交易安全

**目的：保证交易安全性**

结合引导路由和交易路由，支付路由做为一个机制，它完整的承担了由**用户需求体验满意度、支付成功率和收益率**所构成的一个支付的收益管理职能。
![](http://i.imgur.com/cmbjwVK.png)
九层之台起于垒土。路由的实现是以通道为基础的，需要有丰富且类型多样的通道，通道有出款、有收款、有跨境支付等等，具体怎么样，有机会我们再叨叨。



故事讲完了，在老王的管理仓库的过程，也是我们管理卡BIN，设计卡BIN库结构的一个过程，通过卡bin服务去判定通道支持能力，提高支付成功率。

我们从头开始说起，先说说卡BIN的一些基础知识，。

一、卡BIN是什么

卡BIN是发卡行识别码（Bank Identification Number, 缩写为BIN ），又叫发卡机构标识代码Issuer Identification Numbers（IIN）。一般由6位数字组成，2014年年底，国际标准组织（ISO）已经将BIN由6位数字调整到8位数字。目前就国内银行卡来说绝大部分卡BIN是六位

二、卡BIN如何产生

卡BIN由国际标准化组织(ISO)【是全球性非政府组织，负责绝大部分领域标准化活动】分配给各从事跨行转接交换的银行卡组织，再由卡组织分配给各组织内银行。

卡BIN第一位，为发卡行业标识号Major Industry Identifier（MII），代表的是发卡机构所处行业。具体情况如下：

目前我们常见到的卡组织有银联、万事达（Mastercard）、维萨（VISA）、美国运通(AE)、日本国际信用卡（JCB）、大莱卡（Diners Card），他们各自的卡BIN情况如下。

拿如图的银联招商银行借记卡来说，银联的卡BIN是62开头，由ISO分配，招商银行向银联申请卡BIN,银联分配621485作为招商银行借记卡。为了方便了解，举个例子，卡组织就像食品，信用卡借记卡就像食品、招商银行就像厂商比如康师傅，发卡行卡Bin段就像对应的旗下产品比如红烧牛肉面或者老坛酸菜面，后面的卡位数定义了这个产品的最大产量和标准格式，下文提到的通道方相当于供应商张三、李四。

所以每一张银行的诞生，标准流程是发卡行需要向对应卡组织申请对应卡BIN，而卡组织的BIN码由ISO分配。发卡行拿到对应BIN码后再去生成卡号，发给持卡人。


三、卡BIN方案设计

设计卡BIN方案和契约字段有两种方案，一种和通道方无关，另外一种和通道方有关。

第一种方案表结构如下

表结构一