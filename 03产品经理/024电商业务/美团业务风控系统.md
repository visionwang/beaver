[美团点评业务风控系统的构建](http://www.woshipm.com/pd/578335.html)
[美团点评业务风控系统构建经验](https://tech.meituan.com/risk-control-system-experience-sharing.html)


#背景
美团最初以团购的形式出现，到现在有了很大的业务形态转变。尤其是经过与大众点评的业务融合，从单一业务发展成了覆盖到店餐饮、到店综合、猫眼、外卖、酒店、旅游等多个垂直领域的综合性电商，并且在各个领域都处于行业领先的地位。在这背后，美团点评不仅面临激烈的行业竞争，还有**黑色产业（以下简称“黑产”）**带来的各种风险，因为我们的业务有这样一些特点：

* 品类多、覆盖面广：包括几乎所有吃喝玩乐服务，其中不乏容易被销赃的品类。
* 用户多、商户多：美团点评拥有6亿以上用户，400万以上合作商家，覆盖了很大部分国内网民和商户。
* 交易高频：每日订单峰值突破千万。
美团点评对黑产有着巨大的吸引力，归纳起来在这些方面尤其突出：

* 用户作弊：大家常说的**“薅羊毛”**，用户为了骗取促销优惠的作弊行为。
* 商家刷单：常见的有刷排名、刷销量、刷好评等违反商家平台协议的行为。
* 账户和支付安全：公民信息盗用形势已经十分严峻，黑产从业者会在电商平台上盗取用户的余额，或使用他人支付信息来消费。

#系统构建经验
###挑战一：业务多，风险点多
**“感知风险”**  指要收集尽可能完整的数据。风控需要关注：谁、在什么时候、通过什么方式、对什么对象、做了什么？
**“控制风险”**  我们应该站在攻击者的角度思考：攻击者关注什么？答案是利益。

* 促销优惠：相关的风险场景有下单、支付、购买、验券等。
* 商家销量和排名等：涉及购买、搜索、销量展示等页面。
* 用户余额：即需要控制登录、查看余额等动作。

以这样的角度排查，就不容易漏掉风险点。排查清风险点后，实际对接工作也有很大挑战：美团点评的细分业务有100多个，很多业务都有多种用户终端（iPhone, Android，H5，PC等）、多个业务后台（促销工具，商家后台等），需要对接的场景数量很多。所以感知风险、控制风险背后最大的挑战是如何与业务方紧密配合顺利对接。（确实）
**风控工作经验一：安全是业务的必要属性，没有安全保障的产品，终究会被市场淘汰； 风险控制要服务于业务，减少业务对接负担**
1、接入成本
业务系统调用用户中心，用户中心再调用风控透传风控所需参数，而风控的决策也通过用户中心返回给业务后台。这样的好处是只需要用户中心与风控对接一次，业务系统甚至不需要明显感知到风控的存在。同样的道理，与商户中心、支付环节的交互也可以采取类似的设计方法。这样的改造相当于把风险控制的“责任”从业务方移交给了中间件，即由**中间件**来保证提供安全的服务。
2、运行成本
业务接入风控系统后，尤其关心运行过程中的是否会有问题。风控系统要尤其关注以下这些方面：
（1）服务稳定性
隔离部署：在对接的众多后台服务流程中，哪些是核心流程、哪些是非核心流程，需要隔离开防止相互影响。
依赖降级：风控策略需要实时依赖大量外部数据接口和存储，依赖越多稳定性问题发生的概率越大，相应的熔断、降级机制不可缺少。
限流防刷：业务尤其是高风险业务随时可能因爬虫、恶意攻击而造成流量突增。系统需要具备识别和拒绝这些恶意流量的能力，而不是放任其消耗业务后台和风控系统的计算资源。为了做到这一点，风控系统不应仅位于业务系统的调用下游，而要在全局流量入口处插入反爬防刷模块来实现整体控制。
（2）服务性能
1）风控与业务对接可以大致分为两类：
**同步控制接口**，返回风控决策并由上游实时处理。
**异步信息收集接口**，主要目的是收集数据提供风控决策依据。异步接口可以显著减少上游服务的阻塞时间。
2）最初风控策略硬编码在代码中，对运行过程的优化也以人为调整代码为主，但策略调整频繁，运行优化无法跟上策略调整，而且策略复杂度提高后，人为优化代码也不再现实，因此需要在运行时动态决定运行策略才能达到最好的优化效果。这点通过**规则平台**来完成，将在后文中“规则平台”中介绍。
3）风控运营
风控策略不可能做到完全精确，为了降低业务损失很多情况下要以**牺牲一部分用户体验**为代价，因此完善的用户运营保障不可或缺。这在后文的“运营系统”中会提到。TradeOff

###挑战2：变化快
具备感知风险和控制风险的能力后，实现风控策略就是第二个关键问题。最初的策略可以很简单，比如此时我们认定：“穿黑衣服的是坏人”。类似策略运行一段时间后会出现有意思的现象：“坏人会逐渐换上其他颜色衣服”。这也很好理解，攻击者不会持续做无效的攻击浪费资源，而是会转向其他进攻手段。这样旧策略反而只会影响到一部分正常用户——观察到的结果是策略准确率下降。这样的情况无法避免，因为——风控工作经验二： **风控是一项长期的对抗性工作。**
**1、规则平台**
为了解耦系统开发和策略开发，需要让策略执行过程标准化。我们把策略划分成几个层次：
场景：**对应规则集合，一个场景包含若干条规则。**
规则：是最小的决策单元，一个规则包含多个因子。
因子：因子是组成规则的最小逻辑单元。
再看策略开发和决策应用。最初实际工作中这两者耦合在一起不加区分，即针对特定场景开发特定策略。逐渐暴露出一些问题，比如场景会变化、会新增，那原有的策略是否还适用？一个策略是否只能使用固定的决策动作？为了让这两部分工作并行，需要从设计定位上就把两者区分开。即：
策略：是为了识别一些特定的问题，例如“是不是模拟器请求”，“该用户是不是新客”。
决策：是针对场景的应用，如拒绝、验证手机短信等。
规则平台设计让每个场景可以应用不同策略，命中策略后的决策也可以灵活定制，甚至可以配置多个决策，并设置不同优先级

**2、验证中心**
上文中的“决策”代表系统是否信任该请求，风控背后的工作也围绕这个“信任”而展开。拒绝不信任的，放行信任的。但还有不少情况是中间不足以确定的部分，常见的处理方法是需要**让用户补充验证信息来辅助判断**。最初实现的验证流程是：风控服务识别风险后返回决策给业务系统，由业务系统实现验证的完整交互过程。这样存在两个问题：

* 首先业务方很多，不同的业务需要重复实现验证流程，造成重复开发。
* 其次验证种类有很多，从较弱可信度的短信验证，到较高可信度的银行卡验证等——风控能返回什么样的决策受限于特定场景业务方的实现了什么验证支持。
从风控的角度看，以前的处理方式称作“只管杀，不管埋”，优化后可以称之为“杀埋一条龙服务”。
除了规则平台、验证中心，我们还抽象出了累计服务、处罚中心、算法平台等服务来提升风控对抗效率。

###挑战3：我在明，敌在暗
**风控工作经验三：要从事中防守扩展到立体事前、事中、事后防御。**
在风险事前，要注意提升防御能力，减少防御短板：
风险教育：在快速发展的业务中，风险控制的核心在于人，要将风险意识和基本概念传递到业务的各个阶段，明确告知风控可以提供的服务。
参与业务：参与到业务的产品流程中，了解高风险业务、活动的规则，预判风险并给予合适力度的干预。
数据准备：打通数据收集流程，制定预警规则、模型策略等。
主动防护：关注业界风险动态，发生行业安全事件后，或重大活动、产品改动上线前，制定有针对性的规则，甚至采取锁定高危账户、发送预警消息等措施。


在风险事后，要快速响应，灵活管控。客户投诉是风控了解策略效果的最重要指标之一。 针对风险场景，风控还要主动关注异常数据，实现“预警”监控。这些反馈都会进入运营工作流做处理。 运营工作流中，尽管各风控产品具体流程不同，都可以划分为初步受理、核查审理、案件处理三个步骤，对应着以下三个系统：
初步受理：主要用作初步筛选案件，决定是否需要进入下一步骤。其流程较为简单，系统的设计目标是让风控运营人员可以便捷的处理案件，因此处理效率是其中的重要衡量指标。
核查审理：用于详细核查案件，通常有多步骤流程，不同角色以其专业视角做判断。核查过程中需要大量数据支持和处理系统支持，因此有了运营支持系统。
案件处理：确认且涉及到资金损失的案件需要进入赔付流程。因为涉及到资金赔付，精确的权限管理是系统设计和实现时需要特别注意的问题。

运营平台的意义不仅在于处理案件本身，更在于将处理结果反馈到线上系统中实现风控线上和线下的运行闭环。除了运营平台，逆转信息劣势还要靠完善的数据体系的帮助。风险控制所使用的数据可以这样分类：

事件快照：原始而完整的信息，用于生成聚合数据，也是支持运营查询的主要数据源。
聚合事实：相比于原始的事件记录，更多使用场景更关心聚合的结果，例如某用户、某商家的历史购买次数。经过聚合整理后的数据，是进一步数据挖掘的基础。
衍生信息：指基于事件快照和聚合事实衍生出的理解信息，例如用户的作弊风险、设备的可信程度、黑白灰名单等。这些衍生信息可以适配到各个特定场景中使用。
基础数据：除了直接传递到风控的数据外，风控处理过程少不了需要业务甚至是外部的辅助信息。例如，业务相关订单和活动信息、公认的事实数据、外部辅助决策信息等。
![](https://tech.meituan.com/img/risk-control-system-experience-sharing/rc-sys.png)

#风控之道
从上文三条风控工作原则可以看到，风控系统构建过程各个阶段的关注点从对接质量，到平台效率，再过渡到立体的闭环防御。但即使系统发展到了相对成熟的阶段，与黑产的斗争也远没有结束。为了更好的对抗，我们要从对手身上学习：

黑产链条经过长时间的实战优化，分工极为细致。风控团队也应该学习这样的思路，将服务功能切分到细粒度以更好适应变化。
黑产对利益极为敏感，甚至很多时候比业务开发者还要了解业务。风控团队只有比对手更了解“主场”——也就是自身业务，才有可能在对抗中取得主动。
如果把风险控制比喻成一场战争，还可以从军事理论中得到借鉴。《孙子兵法‧谋攻篇》中的一段描述就十分贴切：

“知可以战与不可以战者胜，识众寡之用者胜，上下同欲者胜，以虞待不虞者胜，将能而君不御者胜。此五者，知胜之道也。”

类比到风控工作中，风控团队需要考量：

控制风险是否现实
团队人才质量和数量是否足够
团队价值观是否统一
对风险是否足够了解
是否得到上层支持
这五点就是风控工作的取胜之道啊。

