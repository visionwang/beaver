
**简介**
2012年，阿里巴巴开源其自研的第三代分布式消息中间件——RocketMQ。经过几年的技术打磨，阿里称基于RocketMQ技术，目前双十一当天消息容量可达到**万亿级**。2016年11月，阿里将RocketMQ捐献给Apache软件基金会，正式成为孵化项目。阿里称会将其打造成顶级项目。Apache基金会中的342个项目中，暂时还只有Kylin、CarbonData、Eagle 和 RocketMQ 共计四个中国技术人主导的项目。2017年2月20日，RocketMQ正式发布4.0版本，专家称新版本适用于电商领域，金融领域，大数据领域，兼有物联网领域的编程模型。

**RocketMQ的由来**
阿里中间件消息引擎发展到今日，前前后后经历了三代演进。

**第一代，推模式**，**数据存储采用关系型数据库**。在这种模式下，消息具有很低的延迟特性，并且很容易支持分布式事务。尤其在阿里淘宝这种高频交易场景中，具有非常广泛地应用。典型代表包括**Notify、Napoli**。

**第二代，拉模式，自研的专有消息存储。**在日志处理方面能够媲美Kafka的吞吐性能，但考虑到淘宝的应用场景，尤其是其交易链路的高可靠需求，消息引擎并没有一味的追求吞吐，而是将稳定可靠放在首位。因为采用了长连接拉模式，在消息的实时方面丝毫不逊推模式。典型代表**MetaQ**。

**第三代，以拉模式为主，兼有推模式的高性能、低延迟消息引擎RocketMQ**，在二代功能特性的基础上，为电商金融领域添加了**可靠重试、基于文件存储的分布式事务**等特性，并做了大量优化。从2012年开始，经历了历次双11核心**交易链路**检验。目前已经捐赠给Apache基金会。时至今日，RocketMQ很好的服务了阿里集团大大小小上千个应用，在双11当天，更有不可思议的万亿级消息流转，为集团大中台的稳定发挥了举足轻重的作用。

**RocketMQ的技术概览**
RocketMQ主要由NameServer、Broker、Producer以及Consumer四部分构成，如下图所示。
![](https://i.imgur.com/I4YzGEz.png)
所有的集群都具有水平扩展能力，无单点障碍。
**NameServer**以轻量级的方式提供服务发现和路由功能，每个NameServer存有全量的路由信息，提供对等的读写服务，支持快速扩缩容。
**Broker**负责消息存储，以Topic为纬度支持轻量级的队列，单机可以支撑**上万队列**规模，支持消息推拉模型，具备多副本容错机制（2副本或3副本）、强大的削峰填谷以及**上亿级消息堆积能力**，同时可严格保证消息的**有序性**。除此之外，Broker还提供了同城异地容灾能力，丰富的Metrics统计以及告警机制。

**经历双11洗礼的英雄**
在备战2016年双十一时，团队重点做了两件事情，**优化慢请求与统一存储引擎**。
**优化慢请求**：这里主要是解决在海量高并发场景下降低慢请求对整个集群带来的抖动，毛刺问题。这是一个极具挑战的技术活，团队同学经过长达1个多月的跟进调优，从双十一的复盘情况来看，**99.996%的延迟落在了10ms以内，而99.6%的延迟在1ms以内**。优化主要集中在RocketMQ存储层算法优化、JVM与操作系统调优。
**统一存储引擎**：主要解决的消息引擎的高可用，成本问题。在多代消息引擎共存的前提下，我们对Notify的存储模块进行了全面移植与替换。


**RocketMQ VS 其他几个消息中间件**
请从技术构思、实践表现和适用场景三个大方向对RocketMQ、RabbitMQ、Kafka、ActiveMQ和ZeroMQ进行对比？除了技术上的较量，可否对这些中间件背后的社区运营、商业案例应用，进行对比呢？       
1、是不是CS架构？
如果需要做同类产品之间的横向对比，我们优先拿下ZeroMQ，ZeroMQ正如其名0MQ，它更像是一个嵌入式的网络类库，一个专注于transports层的通讯组件，而不是传统意义上的CS架构的MQ。
2、实现的哪种规范 / 协议？
接下来我们来看看RabbitMQ、ActiveMQ、Kafka和RocketMQ之间的一些对比，从设计思路上来看，RabbitMQ是AMQP规范的参考实现，AMQP是一个线路层协议，面面俱到，很系统，也稍显复杂。目前RabbitMQ已经成为OpenStack Iaas平台首选的消息服务，其背后的支持力度不言而喻。

ActiveMQ最初主要的开发者在LogicBlaze，现在主要开发红帽，是JMS规范的参考实现，也是Apache旗下的老牌消息服务引擎。JMS虽说是一个API级别的协议，但其内部还是定义了一些实现约束，不过缺少多语言支撑。ActiveMQ的生态堪称丰富多彩，在该Apache顶级项目下，拥有不少子项目，包括由HornetMQ演变而来的Artemis，基于Scala号称下一代AMQ的Apollo等。






参考资料
《万亿级数据洪峰下的分布式消息引擎》





